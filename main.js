(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r){var o=e.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=n,this._renderer=o,this._api=r}var n,r;return n=t,(r=[{key:"saveCard",value:function(e){return this._api.saveCard(e).then((function(e){return e}))}},{key:"handleDeletePlace",value:function(e){e.target.closest(".elements__element").remove()}},{key:"deleteCard",value:function(e){return this._api.deleteCard(e).then((function(e){return e}))}},{key:"renderer",value:function(e){var t=this;this._dataToAdd=e,this._dataToAdd.forEach((function(e){return t._renderer(e)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n,r,o,i,a,u){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._myID=t,this._link=n.link,this._name=n.name,this._likes=n.likes,this._cardTemplate=o,this._handleCardClick=i,this._userID=n.owner._id,this._handleCardDelete=a,this._handleCardLike=u,this._handlerLike=function(e){e.preventDefault(),s._event=e,s._handleCardLike(s._id,s._event)},this._id=n._id,this._api=r,this._handlerDelet=function(e){e.preventDefault(),s._event=e,s._handleCardDelete(s._id,s._event)}}var t,r;return t=e,(r=[{key:"_getTemplate",value:function(){this._element=document.querySelector(this._cardTemplate).content.children[0].cloneNode(!0)}},{key:"likeCard",value:function(e){return this._api.putLike(e).then((function(e){return e}))}},{key:"dislikeCard",value:function(e){return this._api.deleteLike(e).then((function(e){return e}))}},{key:"_setEventListeners",value:function(){this._elementImage=this._element.querySelector(".elements__image"),this._element.querySelector(".elements__like").addEventListener("click",this._handlerLike),this._element.querySelector(".elements__delete-button").addEventListener("click",this._handlerDelet),this._elementImage.addEventListener("click",this._handleCardClick)}},{key:"handleLikePlace",value:function(e,t){e.target.classList.toggle("elements__like_active"),e.target.closest(".elements__element").querySelector(".elements__num-like").textContent=t.likes.length}},{key:"generateCard",value:function(){var e=this;return this._getTemplate(),this._setEventListeners(),this._element.querySelector(".elements__text").textContent=this._name,this._elementImage.alt=this._name,this._elementImage.src=this._link,void 0===this._likes?this._likes=[]:this._likes.some((function(t){return t._id===e._myID}))&&this._element.querySelector(".elements__like").classList.add("elements__like_active"),this._element.querySelector(".elements__num-like").textContent=this._likes.length,this._userID===this._myID&&this._element.querySelector(".elements__delete-button").classList.remove("elements__delete-button_hidden"),this._element}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=n,this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}var t,n;return t=e,(n=[{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}},{key:"_showInputError",value:function(e,t){var n=this._form.querySelector(".".concat(e.name,"-error"));e.classList.add(this._inputErrorClass),n.textContent=t}},{key:"_hideInputError",value:function(e){var t=this._form.querySelector(".".concat(e.name,"-error"));e.classList.remove(this._inputErrorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage),this._toggleButtonState()}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t)}))}))}},{key:"enableValidation",value:function(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}},{key:"resetValidation",value:function(){var e=this;this._inputList.forEach((function(t){return e._hideInputError(t)})),this._toggleButtonState()}}])&&o(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupElement=document.querySelector(t),this._crossCloser=function(){n.close()},this._overlayCloser=function(e){n._closePopupOverlay(e)},this._handleEscClose=this._handleEscClose.bind(this),this._closePopupButton=this._popupElement.querySelector(".popup__container-close")}var t,n;return t=e,(n=[{key:"open",value:function(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_closePopupOverlay",value:function(e){e.target===e.currentTarget&&this.close()}},{key:"setEventListeners",value:function(){this._closePopupButton.addEventListener("click",this._crossCloser),this._popupElement.addEventListener("click",this._overlayCloser)}}])&&a(t.prototype,n),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,e))._handleSubmit=t,r._form=r._popupElement.querySelector(".popup__form"),r._inputList=r._form.querySelectorAll(".popup__input"),r._closePopupButton=r._popupElement.querySelector(".popup__container-close"),r._button=r._popupElement.querySelector(".popup__button"),r._handler=function(){r._handleSubmit(r._getInputValues())},r._id=n,r}return t=a,(n=[{key:"renderLoading",value:function(e){e?(this._button.classList.add("popup__button_disabled"),this._button.textContent="Сохранение..."):(this._button.textContent="Сохранить",this._button.classList.remove("popup__button_disabled"))}},{key:"_getInputValues",value:function(){var e=this;return this._formValues={id:this._id},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"close",value:function(){l(h(a.prototype),"close",this).call(this),this._form.reset()}},{key:"setEventListeners",value:function(){l(h(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._handler)}}])&&c(t.prototype,n),a}(u);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(r);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupFotoImage=document.querySelector(".popup__image"),t._fotoCaption=document.querySelector(".popup__caption"),t}return t=a,(n=[{key:"open",value:function(e){this._popupFotoImage.src=e.link,this._popupFotoImage.alt=e.name,this._fotoCaption.textContent=e.name,v(k(a.prototype),"open",this).call(this)}}])&&y(t.prototype,n),a}(u);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(r);if(o){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,e))._submitButton=r._popupElement.querySelector(".popup__button"),r._handleSubmit=n,r._handler=function(){r._handleSubmit(r._cardID,r._cardEvenet)},r._closePopupButton=r._popupElement.querySelector(".popup__container-close"),r._api=t,r}return t=a,(n=[{key:"renderLoading",value:function(e){e?(this._submitButton.classList.add("popup__button_disabled"),this._submitButton.textContent="Удаление..."):(this._submitButton.textContent="Да",this._submitButton.classList.remove("popup__button_disabled"))}},{key:"open",value:function(e,t){C(O(a.prototype),"open",this).call(this),this._cardID=e,this._cardEvenet=t}},{key:"setEventListeners",value:function(){C(O(a.prototype),"setEventListeners",this).call(this),this._submitButton.addEventListener("click",this._handler)}}])&&S(t.prototype,n),a}(u);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._job=document.querySelector(t.job),this._name=document.querySelector(t.name),this._avatar=document.querySelector(t.avatar),this._api=n}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{job:this._job.textContent,name:this._name.textContent}}},{key:"saveUserInfo",value:function(e){return this._api.editUser(e).then((function(e){return e}))}},{key:"saveAvatar",value:function(e){return this._api.editAvatar(e).then((function(e){return e}))}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar;this._name.textContent=t,this._job.textContent=n,this._avatar.src=r}}])&&j(t.prototype,n),e}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(err))}},{key:"getInitialUser",value:function(){return fetch("".concat(this._baseUrl,"users/me"),{method:"GET",headers:this._headers}).then(this._checkResponse)}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"cards/"),{method:"GET",headers:this._headers}).then(this._checkResponse)}},{key:"editUser",value:function(e){return fetch("".concat(this._baseUrl,"users/me/"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}},{key:"editAvatar",value:function(e){return fetch("".concat(this._baseUrl,"users/me/avatar/"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}},{key:"saveCard",value:function(e){return fetch("".concat(this._baseUrl,"cards/"),{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}},{key:"putLike",value:function(e){return fetch("".concat(this._baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(this._checkResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}},{key:"deleteLike",value:function(e){return fetch("".concat(this._baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}])&&q(t.prototype,n),e}(),T={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error-message"},D=document.querySelector(".elements"),U=document.querySelector(".profile__hover-avatar"),B=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),V=document.querySelector(".popup-avatar"),A=document.querySelector(".popup-user"),N=document.querySelector(".popup-place"),F=V.querySelector('[name="edit-avatar"]'),J=A.querySelector('[name="edit-profile"]'),G=(document.querySelector(".profile__name"),document.querySelector(".profile__job"),A.querySelector('[name="name"]')),H=A.querySelector('[name="about"]'),z=N.querySelector('[name="new-place"]'),M="";function K(e,t){var n=new r(M,e,t,"#place-template",(function(){re.open(e)}),(function(e,t){oe.open(e,t)}),(function(e,t){t.target.classList.contains("elements__like_active")?n.dislikeCard(e).then((function(e){n.handleLikePlace(t,e)})).catch((function(e){console.log(e)})):n.likeCard(e).then((function(e){n.handleLikePlace(t,e)})).catch((function(e){console.log(e)}))}));return n.generateCard()}var Q=new i(T,F),W=new i(T,J),X=new i(T,z),Y=new R({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-20/",headers:{authorization:"7b0dc8fa-cb4a-4707-9472-09ad5b621144","Content-Type":"application/json"}}),Z=new I({name:".profile__name",job:".profile__job",avatar:".profile__avatar"},Y),$=new t({renderer:function(e){$.addItem(K(e,Y))}},D,Y),ee=new _(".popup-avatar",(function(e){ee.renderLoading(!0),Z.saveAvatar(e).then((function(e){Z.setUserInfo(e),ee.renderLoading(!1),ee.close()})).catch((function(e){console.log(e)}))}));ee.setEventListeners();var te=new _(".popup-user",(function(e){te.renderLoading(!0),Z.saveUserInfo(e).then((function(e){Z.setUserInfo(e),te.renderLoading(!1),te.close()})).catch((function(e){console.log(e)}))}));te.setEventListeners();var ne=new _(".popup-place",(function(e){ne.renderLoading(!0),$.saveCard(e,"cards").then((function(e){$.addItem(K(e,Y)),ne.renderLoading(!1),ne.close()})).catch((function(e){console.log(e)}))}));ne.setEventListeners();var re=new g(".popup-foto");re.setEventListeners();var oe=new P(".popup-caution",Y,(function(e,t){oe.renderLoading(!0),$.deleteCard(e).then((function(){$.handleDeletePlace(t),oe.renderLoading(!1),oe.close()})).catch((function(e){console.log(e)}))}));oe.setEventListeners(),Y.getInitialUser().then((function(e){Z.setUserInfo(e),M=e._id})).catch((function(e){console.log(e)})),Y.getInitialCards().then((function(e){$.renderer(e)})).catch((function(e){console.log(e)})),Q.enableValidation(),X.enableValidation(),W.enableValidation(),U.addEventListener("click",(function(){Q.resetValidation(),ee.open()})),B.addEventListener("click",(function(){var e=Z.getUserInfo();G.value=e.name,H.value=e.job,W.resetValidation(),te.open()})),x.addEventListener("click",(function(){X.resetValidation(),ne.open()}))})();